{% load static %}

  {% block head %}    
  <!-- ==============================================
  TITLE AND META TAGS
  =============================================== -->
  <title>Cart</title>
<style>
</style>
      <meta name="description" content="">
      <meta name="keywords" content="">
      <meta name="author" content="Quickdev">
      <meta name="theme-color" content="#EEC344">

  <!-- ==============================================
  FAVICON
  =============================================== -->  
      <link rel="shortcut icon" href="{% static 'homepage/img/master/favicon.png' %}">
            <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->

<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- ==============================================
  CSS
  =============================================== -->  
    {% endblock %}
    
  {% block body %}
  <!-- LOADER -->
  {% comment %} <div id="loader-wrapper">
      <div class="loader">
        <div class="square" ></div>
        <div class="square"></div>
        <div class="square last"></div>
        <div class="square clear"></div>
        <div class="square"></div>
        <div class="square last"></div>
        <div class="square clear"></div>
        <div class="square "></div>
        <div class="square last"></div>
      </div>
  </div> {% endcomment %}
  <!-- LOADER -->

<div class="container">
<form action="{% url 'shopping_cart:checkout' %}" method="post">
{% csrf_token %}
	<table id="cart" class="table table-hover table-condensed">
    				<thead>
						<tr>
							<th style="width:50%">Product</th>
							<th style="width:10%">Price</th>
							<th style="width:8%">Quantity</th>
							<th style="width:22%" class="text-center">Subtotal</th>
							<th style="width:10%"></th>
						</tr>
					</thead>
        {% for crops_ordered_names,crops_ordered_images,crops_ordered_cost,crops_ava in total %}

					<tbody>
						<tr>
							<td data-th="Product">
								<div class="row">
									<div class="col-sm-2 hidden-xs"><img src="http://placehold.it/100x100" alt="..." class="img-responsive"/></div>
									<div class="col-sm-10">
										<h4 class="nomargin">{{crops_ordered_names}}</h4>
										<p>Available amount: {{crops_ava}}</p>
									</div>
								</div>
							</td>
							<td data-th="Price" data-type="price">{{crops_ordered_cost}}</td>
							<td data-th="Quantity">
								<input type="number" class="form-control text-center" data-type="quan"  min="1" max="{{crops_ava}}" required>
							</td>
							<td data-th="Subtotal" class="text-center" data-type="subtotal"></td>
							<td class="actions" data-th="">
                                <a href="{% url 'shopping_cart:delete_item' crops_ordered_names%}">
								<button class="btn btn-danger btn-sm"><i class="fa fa-trash-o"></i></button>
                                </a>
							</td>
						</tr>
					</tbody>
        {% endfor %}
					<tfoot>
<!--						<tr class="visible-xs">-->
<!--							<td class="text-center" data-type="total"><strong>Total <span></span></strong></td>-->
<!--						</tr>-->
						<tr>
							<td><a href="{% url 'shopping_cart:buyingpage' %}" class="btn btn-warning"><i class="fa fa-angle-left"></i> Continue Shopping</a></td>
							<td colspan="2" ></td>
							<td class="hidden-xs text-center" data-type="total"><strong>Total <span>0</span></strong> <input type="hidden"  id="amounts"  value="0" name="amounts"> </td>

{#							<td><a href="" class="btn btn-success btn-block">Submit </a></td>#}
                            <td><input  class="btn btn-success btn-block" type="submit" value="Checkout"> </td>
						</tr>
					</tfoot>
				</table>
</form>
</div>
     <!-- ==============================================
JAVASCRIPTS
=============================================== -->
  <script src="{% static 'homepage/js/plugins.js' %}"></script>
  <script src="{% static 'homepage/js/bootstrap.min.js' %}"></script>    
  <script src="{% static 'homepage/js/agrom.js' %}"></script>
<script>
const quantityInputs = document.querySelectorAll('[data-type="quan"]');
const total = document.querySelector('[data-type="total"] span');

// For simplicity, we calculate the total in a separate function.

// As above, we use a separate function to calculate the subtotal for a product.
const calculateSubtotal = (product) => {
  // The input event will fire when the value of the quantity field is changed.
  const subtotals = document.querySelectorAll('[data-type="subtotal"]');
  product.addEventListener('input', () => {
    /*
     * With multiple prices and subtototals, we need to look for them going

     * upwards from the quantity field, using the parent elements (first the
     * table cell, then the table row).
     */
      const subtotals = document.querySelectorAll('[data-type="subtotal"]');
		let tl = 0;
    const parentRow = product.parentNode.parentNode;


    // Then find the price and subtotal for this product.
    const price = parentRow.querySelector('[data-type="price"]');
    const subtotal = parentRow.querySelector('[data-type="subtotal"]');

    // And finally, update the subtotal and the total.
	//   tl += price.textContent * product.value;
	  subtotal.textContent = price.textContent * product.value;
	  Array.from(subtotals).forEach((subtotal) => {
		tl += Number(subtotal.textContent);
	  });

    total.textContent = tl;
    {#document.write(tl);#}
    // document.write(subtotal.value);
      {#$('input[name=amounts]').val(tl);#}
      document.getElementById('amounts').value = tl;
  });
};
// Loop through all the quantity inputs and wait for the subtotal to change.
Array.from(quantityInputs).forEach((element) => calculateSubtotal(element));
</script>
{% comment %} 
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','../../../www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-101241150-1', 'auto');
    ga('send', 'pageview');
  </script>  {% endcomment %}
  {% endblock %}